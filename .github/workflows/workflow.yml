name: CI workflow #It makes Github aware that this is a CI workflow
on: #Triggers
  push: #First trigger when something is push to the main branch
    branches: [ "main" ]
  pull_request: #When someone does a pull request
    branches: [ "main" ]
jobs:
  build: #This will build the app using dependencies
    runs-on: ubuntu-latest #This will be the runner, provided by git, who will carry out the actions
    container: python:3.9-slim #This will ensure that the pipeline runs on the same version of python
    steps: 
      name: checkout
      uses: actions/checkout@v3 #"uses" is used to use a predefined action

      name: Install dependencies
      run: | #runs is used to run code #the pipe operator is used to run multiple lines of script
        python -m pip install --upgrade pip  #Either it installs the last vestion of pip or it updates it.
        pip install -r requirements.txt #Instructs pip to install any dependencies in the file

      name: Lint with flake8 #In this step we are going to check the code for syntactical and stylistic issues.
      run: |
        flake8 service --count --select=E9,F63,F7,F82 --show-source --statistics
        flake8 service --count --max-complexity=10 --max-line-length=127 --statistics
      
      name: Run unit tests with nose #We are going to do unit tests and also check the coverage
      run: nosetests -v --with-spec --spec-color --with-coverage --cover-package=app
